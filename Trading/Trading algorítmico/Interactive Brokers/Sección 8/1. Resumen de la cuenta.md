### **Resumen: Obtener Resumen de la Cuenta en Interactive Brokers**

Esta lección enseña cómo conectarse a la API de **Interactive Brokers (IB)** usando Python para **obtener el resumen general de la cuenta**.  
Se utiliza el método `reqAccountSummary` para solicitar información como el tipo de cuenta, el valor neto de liquidación, el efectivo total disponible y otros datos relevantes.  

El flujo básico es:
1. **Conectarse** a la API de IB usando `EClient` y `EWrapper`.
2. **Solicitar** el resumen de la cuenta especificando las etiquetas (`tags`) deseadas.
3. **Almacenar y mostrar** la información recibida.
4. **Cancelar la suscripción** para detener el flujo continuo de actualizaciones.
5. **Solicitar otros conjuntos de datos** repitiendo el proceso.

> 📌 **Importante:** Algunas solicitudes como `reqAccountSummary` envían actualizaciones continuas hasta que se cancele la suscripción con `cancelAccountSummary`.

---

### **El Bloque de Código Clave**

Este ejemplo muestra cómo:
- Crear una clase que hereda de `EWrapper` y `EClient`.
- Implementar los métodos `accountSummary` y `accountSummaryEnd` para recibir y manejar los datos.
- Usar `threading.Event()` para sincronizar la recepción de datos antes de continuar.
- Cancelar la suscripción para optimizar recursos.

```python
# -*- coding: utf-8 -*-
from ibapi.client import EClient
from ibapi.wrapper import EWrapper
import threading
import time

# Clase que obtiene el Resumen de la Cuenta
class IB_CuentaResumen(EWrapper, EClient):
    def __init__(self):
        EClient.__init__(self, self)
        self.cuenta_resumen = []       # Lista para almacenar los datos recibidos
        self.cuenta_evento = threading.Event()  # Evento para sincronizar la recepción

    def nextValidId(self, orderId):
        self.next_order_id = orderId

    def accountSummary(self, reqId, account, tag, value, currency):
        # Imprimir y almacenar los datos recibidos
        print(f"Cuenta: {account}, Etiqueta: {tag}, Valor: {value}, Moneda: 
	    {currency}")
        self.cuenta_resumen.append((account, tag, value, currency))

    def accountSummaryEnd(self, reqId):
        # Indicar que ya se recibió todo el resumen solicitado
        print("Se recibió el resumen completo de la cuenta")
        self.cuenta_evento.set()

# Conexión a IB
IB_conn = IB_CuentaResumen()
IB_conn.connect(host="127.0.0.1", port=7497, clientId=1)
api_thread = threading.Thread(target=IB_conn.run)
api_thread.start()
time.sleep(3)

# 1. Solicitar resumen con variables clave
IB_conn.reqAccountSummary(1, "All", "AccountType,NetLiquidation,TotalCashValue")
IB_conn.cuenta_evento.wait()
IB_conn.cancelAccountSummary(1)

# 2. Solicitar resumen del libro contable en USD
IB_conn.cuenta_evento.clear()
IB_conn.reqAccountSummary(1, "All", "$LEDGER:USD")
IB_conn.cuenta_evento.wait()
IB_conn.cancelAccountSummary(1)

# Desconectar
IB_conn.disconnect()
api_thread.join()

# Nota:
# - reqAccountSummary envía actualizaciones continuas.
# - Siempre cancelar la suscripción cuando ya no se necesiten los datos.
